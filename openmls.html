<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="description" content="Calcite Maps - ArcGIS 4.x SDK Sample">
    <link rel="icon" href="http://www.esri.com/favicon.ico">
    <title>Calcite Maps - ArcGIS JS 4.0 Example</title>
    <!-- Calcite Bootstrap -- THis is a esri template based on bootstrap that might be useful https://github.com/Esri/calcite-maps-->
    <link rel="stylesheet" href="http://esri.github.com/calcite-maps/dist/css/calcite-bootstrap.min-v0.2.css">
    <!-- Calcite Maps -->
    <link rel="stylesheet" href="http://esri.github.com/calcite-maps/dist/css/calcite-maps-arcgis-4.x.min-v0.2.css">
	    <script src="js/raphael.min.js"></script>
    <script src="js/charts.min.js"></script>
    <style>
    html,
    body {
        margin: 0;
        padding: 0;
        height: 100%;
    }

    .esri-legend {
        overflow: hidden;
    }

    .esri-view-height-medium .esri-popup .esri-popup-content {
        max-height: 200px !important;
    }
    /*  This was used to style the popups, a built in feature of the Esri Javascript API
    .esri-view-width-xlarge .esri-popup .esri-popup-main{
        width: 1273px !important;
        height: 841px !important;
    }

    */

    /* stealing drawer CSS from calcite web */
    /* I WILL ORGANIZE CSS and JS a bit better in a close future */
  .drawer {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width:400px;
    visibility: hidden;
    overflow: hidden;
    opacity: 0;
    -webkit-transition: visibility 0ms linear 200ms, opacity 200ms linear;
    transition: visibility 0ms linear 200ms, opacity 200ms linear;
    z-index: 1001; }
  .drawer.is-active {
    visibility: visible;
    opacity: 1;
    -webkit-transition-delay: 0ms;
    transition-delay: 0ms; }
    .drawer.is-active.drawer-right .drawer-nav {
      -webkit-transform: translate3d(-400px, 0, 0);
      -moz-transform: translate3d(-400px, 0, 0);
      -ms-transform: translate3d(-400px, 0, 0);
      -o-transform: translate3d(-400px, 0, 0);
      transform: translate3d(-400px, 0, 0); }

  .drawer-nav {
    position: absolute;
    top: 0;
    height: 100%;
    width: 400px;
    margin: 0;
    padding: 60px 10px 10px 10px;
    background: #ffffff;
    overflow-x: hidden;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    -webkit-transform: translate3d(0, 0, 0);
    -moz-transform: translate3d(0, 0, 0);
    -ms-transform: translate3d(0, 0, 0);
    -o-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
    -webkit-transition: -webkit- transform 200ms cubic-bezier(0.215, 0.44, 0.42, 0.88);
    -moz-transition: -moz- transform 200ms cubic-bezier(0.215, 0.44, 0.42, 0.88);
    -o-transition: -o- transform 200ms cubic-bezier(0.215, 0.44, 0.42, 0.88);
    transition: transform 200ms cubic-bezier(0.215, 0.44, 0.42, 0.88); }

  .drawer-right .drawer-nav {
    left: 100%; }

  .wrapper {
    -webkit-transition: -webkit- transform 200ms cubic-bezier(0.215, 0.44, 0.42, 0.88);
    -moz-transition: -moz- transform 200ms cubic-bezier(0.215, 0.44, 0.42, 0.88);
    -o-transition: -o- transform 200ms cubic-bezier(0.215, 0.44, 0.42, 0.88);
    transition: transform 200ms cubic-bezier(0.215, 0.44, 0.42, 0.88); }

  .drawer-right-is-active {
    -webkit-transition: -webkit- transform 200ms cubic-bezier(0.215, 0.44, 0.42, 0.88);
    -moz-transition: -moz- transform 200ms cubic-bezier(0.215, 0.44, 0.42, 0.88);
    -o-transition: -o- transform 200ms cubic-bezier(0.215, 0.44, 0.42, 0.88);
    transition: transform 200ms cubic-bezier(0.215, 0.44, 0.42, 0.88);
    -webkit-transform: translate3d(-400px, 0, 0);
    -moz-transform: translate3d(-400px, 0, 0);
    -ms-transform: translate3d(-400px, 0, 0);
    -o-transform: translate3d(-400px, 0, 0);
  transform: translate3d(-400px, 0, 0); }

  .drawer-no-overflow {
    overflow: hidden; }

    .spinner {
      margin: 100px auto 0;
      width: 70px;
      text-align: center;
    }

    .spinner > div {
      width: 18px;
      height: 18px;
      background-color: #196fa6;
      border-radius: 100%;
      display: inline-block;
      -webkit-animation: sk-bouncedelay 1.4s infinite ease-in-out both;
      animation: sk-bouncedelay 1.4s infinite ease-in-out both;
    }

    .spinner .bounce1 {
      -webkit-animation-delay: -0.32s;
      animation-delay: -0.32s;
    }

    .spinner .bounce2 {
      -webkit-animation-delay: -0.16s;
      animation-delay: -0.16s;
    }

    @-webkit-keyframes sk-bouncedelay {
      0%, 80%, 100% { -webkit-transform: scale(0) }
      40% { -webkit-transform: scale(1.0) }
    }

    @keyframes sk-bouncedelay {
      0%, 80%, 100% {
        -webkit-transform: scale(0);
        transform: scale(0);
      } 40% {
        -webkit-transform: scale(1.0);
        transform: scale(1.0);
      }
    }

.innertab{padding:10px;font-size:1.2rem; min-height:400px;border-left:1px solid #a9a9a9;background-color:#f8f8f8}
  .innertab--settings{}
  .innertab--selecteddata{}
  .innertab--cart{}

    </style>
</head>

<body class="calcite-maps calcite-nav-top">
  <div class="drawer drawer-right js-drawer" data-drawer="top-nav" tabName="0">
    <div class="drawer-nav">

  <!-- Nav tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab">Settings</a></li>
    <li role="presentation"><a href="#selecteddata" aria-controls="selecteddata" role="tab" data-toggle="tab">Data</a></li>
    <li role="presentation"><a href="#cart" aria-controls="cart" role="tab" data-toggle="tab"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjAiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMjMyLjk0NSAyMzkuMzMzIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMzIuOTQ1IDIzOS4zMzMiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8Zz4KCTxwYXRoIGZpbGw9IiMxOTZmYTYiIGQ9Ik0xOTQuODQ5LDE3OC43NmwtMy40OTctMjIuMTVsLTEwLjY5OS05Ni45NDVsNC4wOTMtMTUuNTk1bDE2Ljg4OS04Ljg2NmMyLjkzNC0xLjU0MSw0LjA2My01LjE2NywyLjUyMy04LjEwMgoJCWMtMS41NDEtMi45MzQtNS4xNjctNC4wNjQtOC4xMDItMi41MjNsLTE5LjIzMSwxMC4wOTZjLTAuMDM0LDAuMDE4LTAuMDY1LDAuMDQtMC4wOTksMC4wNThjLTAuMTAzLDAuMDU2LTAuMjAzLDAuMTE2LTAuMzAyLDAuMTc4CgkJYy0wLjA3MywwLjA0Ni0wLjE0NiwwLjA5Mi0wLjIxNiwwLjE0MWMtMC4wODcsMC4wNi0wLjE3MSwwLjEyMy0wLjI1NSwwLjE4OGMtMC4wNzQsMC4wNTctMC4xNDgsMC4xMTUtMC4yMiwwLjE3NQoJCWMtMC4wNzUsMC4wNjQtMC4xNDgsMC4xMzEtMC4yMiwwLjE5OWMtMC4wNzEsMC4wNjYtMC4xNDEsMC4xMzItMC4yMDksMC4yMDJjLTAuMDY5LDAuMDcxLTAuMTMzLDAuMTQ1LTAuMTk5LDAuMjE5CgkJYy0wLjA2MiwwLjA3MS0wLjEyNSwwLjE0Mi0wLjE4NCwwLjIxNmMtMC4wNjQsMC4wOC0wLjEyNCwwLjE2NC0wLjE4NCwwLjI0N2MtMC4wNTMsMC4wNzQtMC4xMDYsMC4xNDctMC4xNTUsMC4yMjMKCQljLTAuMDU3LDAuMDg3LTAuMTA5LDAuMTc4LTAuMTYyLDAuMjY5Yy0wLjA0NSwwLjA3OS0wLjA5MSwwLjE1Ny0wLjEzMiwwLjIzN2MtMC4wNDYsMC4wOS0wLjA4OSwwLjE4Mi0wLjEzMSwwLjI3NQoJCWMtMC4wNCwwLjA4OS0wLjA4LDAuMTc4LTAuMTE2LDAuMjY4Yy0wLjAzNCwwLjA4Ny0wLjA2NiwwLjE3NS0wLjA5NiwwLjI2NWMtMC4wMzUsMC4xMDMtMC4wNjgsMC4yMDYtMC4wOTgsMC4zMQoJCWMtMC4wMTIsMC4wNDEtMC4wMjcsMC4wNzktMC4wMzgsMC4xMmwtNC4wNTQsMTUuNDQ0TDM2LjczLDc1LjA4MWMtMC4wNzksMC4wMTMtMC4xNTQsMC4wMzQtMC4yMzIsMC4wNDkKCQljLTAuMTEyLDAuMDIyLTAuMjI0LDAuMDQyLTAuMzMzLDAuMDdjLTAuMDg4LDAuMDIzLTAuMTczLDAuMDUyLTAuMjYsMC4wNzljLTAuMTA1LDAuMDMyLTAuMjEyLDAuMDYyLTAuMzE0LDAuMQoJCWMtMC4wODgsMC4wMzItMC4xNzIsMC4wNzEtMC4yNTcsMC4xMDhjLTAuMDk2LDAuMDQxLTAuMTkzLDAuMDc5LTAuMjg3LDAuMTI0Yy0wLjA4OCwwLjA0My0wLjE3MSwwLjA5MS0wLjI1NiwwLjEzOAoJCWMtMC4wODYsMC4wNDctMC4xNzQsMC4wOTItMC4yNTcsMC4xNDNjLTAuMDg1LDAuMDUyLTAuMTY1LDAuMTEtMC4yNDcsMC4xNjZjLTAuMDc4LDAuMDU0LTAuMTU4LDAuMTA1LTAuMjM0LDAuMTYyCgkJYy0wLjA4LDAuMDYxLTAuMTU1LDAuMTI3LTAuMjMyLDAuMTkxYy0wLjA3MSwwLjA1OS0wLjE0MywwLjExNy0wLjIxMSwwLjE3OWMtMC4wNzQsMC4wNjktMC4xNDMsMC4xNDItMC4yMTQsMC4yMTUKCQljLTAuMDY0LDAuMDY1LTAuMTMsMC4xMjgtMC4xOSwwLjE5NmMtMC4wNjcsMC4wNzUtMC4xMjgsMC4xNTQtMC4xOTIsMC4yMzNjLTAuMDU4LDAuMDcxLTAuMTE3LDAuMTQxLTAuMTcyLDAuMjE0CgkJYy0wLjA1OSwwLjA4LTAuMTEyLDAuMTY1LTAuMTY3LDAuMjQ4Yy0wLjA1MSwwLjA3Ny0wLjEwNCwwLjE1My0wLjE1MiwwLjIzMmMtMC4wNSwwLjA4NC0wLjA5NCwwLjE3Mi0wLjE0MSwwLjI1OQoJCWMtMC4wNDQsMC4wODMtMC4wOTEsMC4xNjUtMC4xMzIsMC4yNWMtMC4wNDIsMC4wODgtMC4wNzcsMC4xNzgtMC4xMTQsMC4yNjhjLTAuMDM3LDAuMDg5LTAuMDc2LDAuMTc2LTAuMTA5LDAuMjY2CgkJYy0wLjAzMywwLjA5MS0wLjA1OSwwLjE4NC0wLjA4NywwLjI3N2MtMC4wMjksMC4wOTMtMC4wNiwwLjE4NS0wLjA4NCwwLjI3OWMtMC4wMjQsMC4wOTUtMC4wNDEsMC4xOTItMC4wNiwwLjI4OAoJCWMtMC4wMTksMC4wOTYtMC4wNDEsMC4xOS0wLjA1NiwwLjI4N2MtMC4wMTUsMC4wOTgtMC4wMjIsMC4xOTctMC4wMzIsMC4yOTZjLTAuMDEsMC4wOTgtMC4wMjMsMC4xOTYtMC4wMjgsMC4yOTUKCQljLTAuMDA1LDAuMDk4LTAuMDAyLDAuMTk3LTAuMDAyLDAuMjk2YzAsMC4xMDItMC4wMDMsMC4yMDQsMC4wMDIsMC4zMDdjMC4wMDUsMC4wOTUsMC4wMTgsMC4xOTEsMC4wMjcsMC4yODcKCQljMC4wMDksMC4wOTQsMC4wMTMsMC4xODgsMC4wMjYsMC4yODJsOC42NTQsNTkuNjE2YzAuMDAzLDAuMDE5LDAuMDEsMC4wMzUsMC4wMTMsMC4wNTRjMC4wNSwwLjMyNiwwLjEyOCwwLjY0NCwwLjIyOSwwLjk1MgoJCWMwLjAxNiwwLjA0OCwwLjAzMiwwLjA5NSwwLjA0OCwwLjE0MmMwLjEwNCwwLjI5MywwLjIzLDAuNTc2LDAuMzc3LDAuODQ2YzAuMDI4LDAuMDUyLDAuMDU4LDAuMTAxLDAuMDg3LDAuMTUyCgkJYzAuMTUzLDAuMjYzLDAuMzIyLDAuNTE2LDAuNTEzLDAuNzUyYzAuMDI5LDAuMDM2LDAuMDYsMC4wNjksMC4wOSwwLjEwNGMwLjIwNiwwLjI0NCwwLjQyNiwwLjQ3NSwwLjY2OCwwLjY4NAoJCWMwLjAwNCwwLjAwMywwLjAwOCwwLjAwNiwwLjAxMywwLjAxYzAuMjQ5LDAuMjE0LDAuNTE5LDAuNDA1LDAuODAzLDAuNTc2YzAuMDIsMC4wMTIsMC4wMzgsMC4wMjUsMC4wNTgsMC4wMzcKCQljMC4yNjksMC4xNTgsMC41NTQsMC4yOTIsMC44NDksMC40MDhjMC4wNDksMC4wMTksMC4wOTYsMC4wMzksMC4xNDUsMC4wNTdjMC4yOCwwLjEwMiwwLjU3MSwwLjE4MiwwLjg3MSwwLjI0MgoJCWMwLjA2NywwLjAxMywwLjEzNSwwLjAyNCwwLjIwMywwLjAzNWMwLjA4NCwwLjAxNCwwLjE2NywwLjAzMywwLjI1MiwwLjA0M2wxMzQuNTc2LDE2LjI0NWwyLjUyNSwxNS45OTFINzQuMzQ2CgkJYy0xLjUsMC0yLjg2OSwwLjU1NS0zLjkyMSwxLjQ2NWMtNy40MzgsMC4yNzYtMTMuMzg3LDYuMzc3LTEzLjM4NywxMy44ODJjMCw3LjY4MSw2LjIyNywxMy45MDgsMTMuOTA4LDEzLjkwOAoJCXMxMy45MDgtNi4yMjcsMTMuOTA4LTEzLjkwOGMwLTEuMTU2LTAuMTU3LTIuMjczLTAuNDIyLTMuMzQ3aDk0LjM4MmMtMC4wNjUsMC41NDUtMC4xMDgsMS4wOTYtMC4xMDgsMS42NTgKCQljMCw3LjY4MSw2LjIyNywxMy45MDgsMTMuOTA4LDEzLjkwOGM3LjY4MSwwLDEzLjkwOC02LjIyNywxMy45MDgtMTMuOTA4QzIwNi41MjQsMTg1LjU1MywyMDEuNDY2LDE3OS44MzEsMTk0Ljg0OSwxNzguNzZ6CgkJIE01MS42MDUsMTM1LjIxNmwtNy4xNDQtNDkuMjE1bDEyNC44MzMtMTkuODY4bDkuMzE2LDg0LjQxNEw1MS42MDUsMTM1LjIxNnoiLz4KPC9nPgo8Zz4KCTxnPgoJCTxwYXRoIGZpbGw9IiMxOTZmYTYiIGQ9Ik02OS4zNjIsMTMzLjAyMWMtMi42NjYsMC01LjAwNy0xLjk0Mi01LjQyOC00LjY1OWwtNS4zMTgtMzQuMzE0Yy0wLjQ2NS0zLjAwMSwxLjU5MS01LjgxMiw0LjU5My02LjI3NwoJCQljMy4wMDMtMC40NjYsNS44MTIsMS41OTEsNi4yNzcsNC41OTNsNS4zMTgsMzQuMzE0YzAuNDY1LDMuMDAxLTEuNTkxLDUuODEyLTQuNTkzLDYuMjc3CgkJCUM2OS45MjYsMTMyLjk5OSw2OS42NDIsMTMzLjAyMSw2OS4zNjIsMTMzLjAyMXoiLz4KCTwvZz4KCTxnPgoJCTxwYXRoIGZpbGw9IiMxOTZmYTYiIGQ9Ik04OC40NTcsMTM1LjMxMWMtMi42NjYsMC01LjAwNy0xLjk0Mi01LjQyOC00LjY1OWwtNi4xNDktMzkuNjgyYy0wLjQ2NS0zLjAwMiwxLjU5MS01LjgxMiw0LjU5My02LjI3NwoJCQljMy4wMDEtMC40NjgsNS44MTIsMS41OTEsNi4yNzcsNC41OTNsNi4xNDksMzkuNjgyYzAuNDY1LDMuMDAyLTEuNTkxLDUuODEyLTQuNTkzLDYuMjc3CgkJCUM4OS4wMjEsMTM1LjI5LDg4LjczNiwxMzUuMzExLDg4LjQ1NywxMzUuMzExeiIvPgoJPC9nPgoJPGc+CgkJPHBhdGggZmlsbD0iIzE5NmZhNiIgZD0iTTEwNy41NTEsMTM3LjYwMWMtMi42NjYsMC01LjAwNy0xLjk0Mi01LjQyOC00LjY1OWwtNi45ODEtNDUuMDQ5Yy0wLjQ2NS0zLjAwMiwxLjU5MS01LjgxMiw0LjU5My02LjI3NwoJCQljMy0wLjQ3LDUuODEyLDEuNTkxLDYuMjc3LDQuNTkzbDYuOTgxLDQ1LjA0OWMwLjQ2NSwzLjAwMi0xLjU5MSw1LjgxMi00LjU5Myw2LjI3NwoJCQlDMTA4LjExNSwxMzcuNTgsMTA3LjgzMSwxMzcuNjAxLDEwNy41NTEsMTM3LjYwMXoiLz4KCTwvZz4KCTxnPgoJCTxwYXRoIGZpbGw9IiMxOTZmYTYiIGQ9Ik0xMjYuNjQ2LDEzOS44OTJjLTIuNjY2LDAtNS4wMDctMS45NDItNS40MjgtNC42NTlsLTcuODEzLTUwLjQxN2MtMC40NjUtMy4wMDIsMS41OTEtNS44MTIsNC41OTMtNi4yNzcKCQkJYzMuMDAzLTAuNDY3LDUuODEyLDEuNTkxLDYuMjc3LDQuNTkzbDcuODEzLDUwLjQxN2MwLjQ2NSwzLjAwMi0xLjU5MSw1LjgxMi00LjU5Myw2LjI3NwoJCQlDMTI3LjIwOSwxMzkuODcsMTI2LjkyNSwxMzkuODkyLDEyNi42NDYsMTM5Ljg5MnoiLz4KCTwvZz4KCTxnPgoJCTxwYXRoIGZpbGw9IiMxOTZmYTYiIGQ9Ik0xNDUuNzQsMTQyLjE4MmMtMi42NjYsMC01LjAwNy0xLjk0Mi01LjQyOC00LjY1OWwtOC42NDUtNTUuNzg1Yy0wLjQ2NS0zLjAwMiwxLjU5MS01LjgxMiw0LjU5My02LjI3NwoJCQljMy4wMDEtMC40NjksNS44MTIsMS41OTEsNi4yNzcsNC41OTNsOC42NDUsNTUuNzg1YzAuNDY1LDMuMDAyLTEuNTkxLDUuODEyLTQuNTkzLDYuMjc3CgkJCUMxNDYuMzA0LDE0Mi4xNiwxNDYuMDIsMTQyLjE4MiwxNDUuNzQsMTQyLjE4MnoiLz4KCTwvZz4KCTxnPgoJCTxwYXRoIGZpbGw9IiMxOTZmYTYiIGQ9Ik0xNjQuODM1LDE0NC40NzJjLTIuNjY2LDAtNS4wMDctMS45NDItNS40MjgtNC42NTlsLTkuNDc3LTYxLjE1MmMtMC40NjUtMy4wMDIsMS41OTEtNS44MTIsNC41OTMtNi4yNzcKCQkJYzIuOTk5LTAuNDY2LDUuODEyLDEuNTkxLDYuMjc3LDQuNTkzbDkuNDc3LDYxLjE1MmMwLjQ2NSwzLjAwMi0xLjU5MSw1LjgxMi00LjU5Myw2LjI3NwoJCQlDMTY1LjM5OSwxNDQuNDUxLDE2NS4xMTUsMTQ0LjQ3MiwxNjQuODM1LDE0NC40NzJ6Ii8+Cgk8L2c+CjwvZz4KPC9zdmc+" width=26 height=22> Cart</a></li>
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
    <div role="tabpanel" class="tab-pane" id="settings">
      <div class="innertab innertab--settings">
        <!-- accordion  -->

          <div class="panel-group" id="accordionSettings">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordionSettings" href="#collapseOne">Legend</a></h4></div>
              <div id="collapseOne" class="panel-collapse collapse">
                <div class="panel-body">Legend goes here.</div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordionSettings" href="#collapseTwo">Descriptive Information</a></h4></div>
              <div id="collapseTwo" class="panel-collapse collapse">
                <div class="panel-body">Descriptive info goes here
<div id='chart1' style='width: 350px; height: 200px;'>				</div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordionSettings" href="#collapseThree">Filters</a></h4></div>
              <div id="collapseThree" class="panel-collapse collapse in">
                <div class="panel-body">
                  <form method="post">
                  <div class="row">
                   <div class="col-xs-6">
                     <div class="form-group ">
                      <label class="control-label " for="hgt">
                       Height for MLS data
                      </label>
                      <select class="select form-control" id="hgt" name="hgt">
                       <option value="MLS_Inspections">
                        MLS Inspections
                       </option>
                       <option value="MLS_Violations">
                        MLS Violations
                       </option>
                      </select>
                     </div>
                     <div class="form-group ">
                       <div class="checkbox">
                        <label class="checkbox">
                         <input name="MSL_filters" type="checkbox" value="First Choice"/>
                         First Choice
                        </label>
                       </div>
                       <div class="checkbox">
                        <label class="checkbox">
                         <input name="MSL_filters" type="checkbox" value="Second Choice"/>
                         Second Choice
                        </label>
                       </div>
                       <div class="checkbox">
                        <label class="checkbox">
                         <input name="MSL_filters" type="checkbox" value="Third Choice"/>
                         Third Choice
                        </label>
                       </div>
                     </div>
                     </div>
                     <div class="col-xs-6">
                     <div class="form-group ">
                      <label class="control-label " for="fire">
                       Colors for Fire data
                      </label>
                      <select class="select form-control" id="fire" name="fire">
                      <option value="Fire_Inspections">
                       Fire Inspections
                      </option>
                      <option value="Fire_Violations">
                       Fire Violations
                      </option>
                      </select>
                     </div>
                     <div class="form-group ">
                       <div class="checkbox">
                        <label class="checkbox">
                         <input name="MSL_filters" type="checkbox" value="First Choice"/>
                         First Choice
                        </label>
                       </div>
                       <div class="checkbox">
                        <label class="checkbox">
                         <input name="MSL_filters" type="checkbox" value="Second Choice"/>
                         Second Choice
                        </label>
                       </div>
                       <div class="checkbox">
                        <label class="checkbox">
                         <input name="MSL_filters" type="checkbox" value="Third Choice"/>
                         Third Choice
                        </label>
                       </div>
                     </div>
                   </div>
                  </div>



                  <div class="row">
                   <div class="col-xs-6">
                    <div class="form-group">
                     <div>
                      <button class="btn btn-primary btn-block" name="submit" type="submit">
                       Filter
                      </button>
                     </div>
                    </div>
                  </div>
                  <div class="col-xs-6">
                   <div class="form-group">
                    <div>
                     <button class="btn btn-default btn-block" name="reset">
                      Clear
                     </button>
                    </div>
                   </div>
                  </div>
                  </div>





                  </form>

                </div>
              </div>
            </div>
          </div>
        <!-- / accordion  -->

      </div>
    </div>
    <div role="tabpanel" class="tab-pane" id="selecteddata">
      <div class="innertab innertab--selecteddata">There is no data selected. Click on a building to retrive information.</div>
    </div>
    <div role="tabpanel" class="tab-pane" id="cart">
      <div class="innertab innertab--cart">
        Your cart is empty, you don't have anything to download.
      </div>
    </div>
  </div>
    </div>
  </div>
  <div class="wrapper">
    <!-- Navbar  Here is where you can likely add in a lot of the functionality we talked about, drop downs, radio buttions, shopping cart, table view etc. -->
    <nav class="navbar calcite-navbar navbar-fixed-top calcite-text-light calcite-bg-dark calcite-bgcolor-dark-blue">
        <!-- Header -->
        <div class="navbar-header">
            <a class="navbar-brand" role="button" id="calciteToggleNavbar" aria-haspopup="true">
        <span class="esri-icon esri-icon-map-pin"></span>
      </a>
        </div>
        <!-- Title -->
        <div class="calcite-title calcite-overflow-hidden">
            <span class="calcite-title-main">Geocollective</span>
            <span class="calcite-title-divider hidden-xs"></span>
            <span class="calcite-title-sub hidden-xs">Toronto Inspection</span>
        </div>
        <!-- Nav
		I would try to cram as much functionality into this drop down menu, perhaps making is as a collapseable sidebar is ideal.

		-->
        <ul class="calcite-nav nav navbar-nav">
            <li><a href="#" class="js-drawer-toggle" data-drawer="right"><span class="glyphicon glyphicon-list"></span></a></li>
        </ul>
    </nav>
    <!--/.navbar -->
    <!-- Map Container  -->
    <div class="calcite-map calcite-map-absolute">
        <div id="mapViewDiv"></div>
    </div>
    <!-- /.container -->
    <script type="text/javascript">
    var dataBank = {};
    var API_URL = 'https://was-inter-sit.toronto.ca/c3api_data/v2/DataAccess.svc';
    var dojoConfig = {
        packages: [{
                name: "bootstrap",
                location: "http://esri.github.com/calcite-maps/dist/vendor/dojo-bootstrap"
            },
            {
                name: "calcite-maps",
                location: "http://esri.github.com/calcite-maps/dist/js/dojo"
            }
        ]
    };
    </script>
    <link rel="stylesheet" href="https://js.arcgis.com/4.5/esri/css/main.css">
    <script src="https://js.arcgis.com/4.5/"></script>
    <script>
    var dataBank = {};
 require([
      "esri/Map",
      "esri/views/SceneView",
      "esri/layers/FeatureLayer",
      "esri/widgets/Legend",
      "esri/symbols/PointSymbol3D",
      "esri/symbols/ObjectSymbol3DLayer",
      "dojo/promise/all",
      "dojo/Deferred",
	  "dojo/request/xhr",
	  "dojo/query",
	  "bootstrap/Tab",
	  "bootstrap/Collapse",
	  "dojo/domReady!"
    ], function(
      Map, SceneView, FeatureLayer, Legend,PointSymbol3D,
      ObjectSymbol3DLayer,all, Deferred,xhr,query,tab
    ) {

  var map = new Map({
    basemap: "dark-gray-vector"
  });

var	 symbol =   new PointSymbol3D({
          symbolLayers: [new ObjectSymbol3DLayer({
            resource: {
              primitive: "cone"
            },
            width: 50 // width of the symol in meters
          })]
        })
 var renderer = {
        type: "simple", // autocasts as new SimpleRenderer()
              symbol: symbol,
        visualVariables: [{
          type: "size",
          field: "MLSVIO",
		  legendOptions: {
            title: "Number of MLS Violations per Parcel (EXTRUDED HEIGHT)"
          },
          stops: [
          {
            value: 0,
            size: 25,
            label: "0"
          },
          {
            value: 160,
            size: 1000,
            label: "160"
          }],
          axis: "height"
        },{
          type: "size",
          axis: "width-and-depth",
          useSymbolValue: true // uses the width value defined in the symbol layer (50,000)
        }, {
          type: "color",
          field: "FIREVIOL",

          legendOptions: {
            title: "Number of Fire Violations per Parcel"
          },
          stops: [
          {
            value: 2,
            color: [255,255,204,.7],
            label: "<2"
          },
		  {
            value: 3,
            color: [255,237,160,.7],
            label: "<3"
          },
		  {
            value: 5,
            color: [254,178,76,.7],
            label: "<5"
          },
		  {
            value: 10,
            color: [252,78,42,.7],
            label: "<10"
          },
          {
            value: 20,
            color: [128,0,38,.7],
            label: ">20"
          }]
        }]
      };
  var featureLayer = new FeatureLayer({
    url:  "https://services5.arcgis.com/5R55vsKfq7f14num/arcgis/rest/services/finalfinal/FeatureServer/0",
	title: "Property Inspection Violations",
	renderer: renderer,
	outFields: ["*"],
// 	popupTemplate: { // autocasts as new PopupTemplate()
//   title: "ParcelID: {RID}",
//   content: "<p>The property located at, <b>{Match_addr}</b> owened by " +
// 						" <b>{PROPERTY_O}</b> had the following MLS and FIRE inspection/violation information:</p>" +
// 						"<ul><b>{MLSINSP}</b> MLS inspections with</li>" +
// 						"<li><b>{MLSVIO}</b> MLS violations</li></ul>" +
// 						"<ul><li><b>{FIREINSP}</b> FIRE inspections with</li>" +
// 						"<li><b>{FIREVIOL}</b> FIRE violations</li></ul>"
// }
  });

  map.add(featureLayer);

        var view = new SceneView({
            container: "mapViewDiv",
            padding: {
                top: 50
            },
            map: map
        });
view.then(function(){
  view.goTo({
    center: [-79.261723, 43.572808],
    tilt: 70,
    zoom: 9})
});
      var legend = new Legend({
        view: view
      });

      view.ui.add(legend, "bottom-right");


		view.on("click", function(evt) {

            dataBank.parcels = dataBank.parcels||{}
            view.hitTest(evt.screenPoint).then(function(response) {
                var graphic = response.results[0].graphic;
                function fireRequest(UID){
                  var fireInspectionsURL = `${API_URL}/dataproject/fire?$filter=RID eq '${UID}'`;
                  var deferred = new Deferred();
                  xhr(fireInspectionsURL, {
                      handleAs: "json"
                  })
                  .then(
                    // success
                    function(data){
                      if (data.value.length==0){
                        deferred.resolve([]);
                      }
                      else{
                        var fireViolationsURL = `${API_URL}/fireprevention/extractInspection?$filter=propertyAddress eq '${data.value[0].PROPERTYAD}'&$orderby=INSPECTIONS_CLOSEDDATE desc,VIOLATIONS_ITEM_NUMBER asc`;
                        xhr(fireViolationsURL, {
                            handleAs: "json"
                        })
                        .then(
                          // success
                          function(data2){
                            deferred.resolve([data.value,data2.value]);
                          },
                          //error
                          function(){
                            deferred.cancel("Fire Violations API failed");
                          }
                        );
                      }
                    },
                    //error
                    function(){
                      deferred.cancel("Fire API failed");
                    }
                  );
                  return deferred.promise;
                }
                function mlsRequest(UID){
                  var deferred = new Deferred();
                  var mlsInspectionsURL = `${API_URL}/dataproject/mls?$filter=RID eq '${UID}'`;
                   xhr(mlsInspectionsURL, {
                       handleAs: "json"
                   })
                  .then(
                    // success
                    function(data){
                      if (data.value.length==0){
                        deferred.resolve([]);
                      }
                      else{
                        var mlsViolations =`${API_URL}/dataproject/def?$filter=INVESTIGATIONID eq '${data.value[0].INVESTIGATIONID}'`;
                        if (data.value.length>1){
                          for (var i = 1; i < data.value.length; i++) {
                            mlsViolations += ` or INVESTIGATIONID eq '${data.value[i].INVESTIGATIONID}'`
                          }
                        }
                        xhr(mlsViolations, {
                            handleAs: "json"
                        })
                        .then(
                          // success
                          function(data2){
                            deferred.resolve([data.value,data2.value]);
                          },
                          //error
                          function(){
                            deferred.cancel("MLS deficiencies API failed");
                          }
                        );
                      }
                    },
                    //error
                    function(){
                      deferred.cancel("MLS API failed");
                    }
                  );
                  return deferred.promise;
                }
                if (graphic) {
                    // console.log("Top graphic found! Here it is: ", graphic);
                    var UID = graphic.attributes.OBJECTID||false;
                    if (!UID) return false;
                    dataBank.parcels[UID]=dataBank.parcels[UID]||{};
                    // check if data aready retrieved
                    if(dataBank.parcels[UID].hasOwnProperty('fireInspections') && dataBank.parcels[UID].hasOwnProperty('mlsInspections')){
                      displayBuildingData(UID);
                    }
                    else {
                      loaderStart();
                      all([fireRequest(UID),mlsRequest(UID)])
                      .then(function(results){
                        loaderStop();
                        dataBank.parcels[UID]={
                          fireInspections: results[0],
                          mlsInspections: results[1]
                        }
                        displayBuildingData(UID)
                      });
                    }

                }
            });
        });

        function displayBuildingData(uid){
          if(!dataBank.parcels.hasOwnProperty(uid)){
            return false;
          }
          openDrawer('selecteddata');
          console.log(dataBank.parcels[uid]);
          var isFire = dataBank.parcels[uid].hasOwnProperty('fireInspections') && Array.isArray(dataBank.parcels[uid].fireInspections),
              isMls =  dataBank.parcels[uid].hasOwnProperty('mlsInspections') && Array.isArray(dataBank.parcels[uid].mlsInspections)
              building = (function(){
                var objReturn = {};
                if (isFire && dataBank.parcels[uid].fireInspections[0][0]){
                  objReturn.address = dataBank.parcels[uid].fireInspections[0][0].PROPERTYAD;
                  objReturn.owner = dataBank.parcels[uid].fireInspections[0][0].PROPERTY_O||'n/a';
                  objReturn.fireInspectionSummary = {
                    inspections:parseInt(dataBank.parcels[uid].fireInspections[0][0].INSPECTION),
                    violations:parseInt(dataBank.parcels[uid].fireInspections[0][0].VIOLATIONS)
                  };
                }
                if(isMls && dataBank.parcels[uid].mlsInspections[0][0]){
                  objReturn.address = objReturn.address || dataBank.parcels[uid].mlsInspections[0][0].ADDRESS;
                  objReturn.mlsInspectionSummary = {
                    inspections:dataBank.parcels[uid].mlsInspections[0].length,
                    violations:dataBank.parcels[uid].mlsInspections[1].length,
                  }
                }
                return objReturn;
              })(),
              violations =  isFire?dataBank.parcels[uid].fireInspections[1]:null,
              mlsInspections = isMls?dataBank.parcels[uid].mlsInspections[0]:null,
              deficiencies = isMls?dataBank.parcels[uid].mlsInspections[1]:[];

          // display Building info
          var html = `<div class="row">
            <div class="col-xs-12"><h3>Building Report</h3></div>
            <div class="col-xs-4">Address</div>
            <div class="col-xs-8">${building.address}</div>
            <div class="col-xs-4">Owner</div>
            <div class="col-xs-8">${building.owner||'n/a'}</div>
            <div class="col-xs-12">${building.fireInspectionSummary.inspections} Fire Inspections (${building.fireInspectionSummary.violations} Violations)</div>
            <div class="col-xs-12">${building.mlsInspectionSummary.inspections} MLS Inspections (${building.mlsInspectionSummary.violations} Violations)</div>
          </div>`;
          if (isFire){
            html+=`<div class="row"><div class="col-xs-12">
              &nbsp;
            </div></div><div class="row">
              <div class="col-xs-12"><strong>Fire Inspections</strong></div>
              <div class="col-xs-12"><table class="table table-stripped table-condensed">
                <thead>
                  <tr>
                    <th>Location</th>
                    <th>Sublocation</th>
                    <th>status</th>
                  </tr>
                </thead>
                <tbody>
                  ${deficiencies.map(function(obj){
                    return `<tr>
                      <td>${obj.LOCATION}</td>
                      <td>${obj.SUBLOCATION}</td>
                      <td>${obj.STATUS}</td>
                    </tr>
                    <tr>
                      <td colspan="3">${obj.DETAILS}</td>
                    </tr>`
                  }).join('')}
                </tbody>
              </table></div>
            </div>`;
          }

          // display HTML in tab
          displayDataTab(html);
        }

         function openDrawer(tabName){
           tabName = tabName||'settings';
            document.getElementsByClassName('js-drawer')[0].classList.add('is-active');
            query('a[href="#'+tabName+'"]').tab('show')
         }
         function closeDrawer(){
            document.getElementsByClassName('js-drawer')[0].classList.remove('is-active');
         }
         function toggleDrawer(){
           if (document.getElementsByClassName('js-drawer')[0].classList.contains('is-active')) {
             closeDrawer()
           } else {
             openDrawer()
           }
         }
         function loaderStart(){
          displayDataTab(`<div class="spinner">
            <div class="bounce1"></div>
            <div class="bounce2"></div>
            <div class="bounce3"></div>
          </div>`)
         }
         function loaderStop(){
           var elements = document.getElementsByClassName('spinner');
            while(elements.length > 0){
                elements[0].parentNode.removeChild(elements[0]);
            }
         }
         function displayDataTab(html){
           html = html || "Error!";
           query('#selecteddata .innertab').attr("innerHTML", html);
         }
         // on button click -> toggle the drawer
         document.getElementsByClassName('js-drawer-toggle')[0].addEventListener('click', toggleDrawer);
         // close the drawer if click on brand
         document.getElementById('calciteToggleNavbar').addEventListener('click', closeDrawer);
         document.onkeydown = function(evt) {
             evt = evt || window.event;
             var isEscape = false;
             if ("key" in evt) {
                 isEscape = (evt.key == "Escape" || evt.key == "Esc");
             } else {
                 isEscape = (evt.keyCode == 27);
             }
             if (isEscape) {
                closeDrawer();
             }
         };

    });



    </script>
  </div><!-- /.wrapper -->
</body>

</html>